{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kenny/OneDrive%20-%20Bina%20Nusantara/Sem%205/Deep%20Learning/DL_Projects/frontend/app/api/stream/route.ts"],"sourcesContent":["// Server-Sent Events untuk real-time updates\r\nimport { type NextRequest, NextResponse } from \"next/server\"\r\n\r\nconst BACKEND_URL = process.env.BACKEND_URL || \"http://localhost:5000\"\r\n\r\nexport async function GET(req: NextRequest) {\r\n  const encoder = new TextEncoder()\r\n\r\n  const customReadable = new ReadableStream({\r\n    async start(controller) {\r\n      try {\r\n        const response = await fetch(`${BACKEND_URL}/api/stream`)\r\n\r\n        if (!response.ok) throw new Error(\"Stream connection failed\")\r\n\r\n        const reader = response.body?.getReader()\r\n        if (!reader) throw new Error(\"No response body\")\r\n\r\n        while (true) {\r\n          const { done, value } = await reader.read()\r\n          if (done) break\r\n\r\n          // Transform backend format ke frontend format\r\n          const text = new TextDecoder().decode(value)\r\n          const lines = text.split(\"\\n\")\r\n          for (const line of lines) {\r\n            if (line.startsWith(\"data: \")) {\r\n              try {\r\n                const data = JSON.parse(line.substring(6))\r\n                const transformed = `data: ${JSON.stringify({\r\n                  maleIn: data.male_in,\r\n                  maleOut: data.male_out,\r\n                  femaleIn: data.female_in,\r\n                  femaleOut: data.female_out,\r\n                  currentCount: data.current_count,\r\n                  fps: data.fps || 0,\r\n                  timestamp: Date.now(),\r\n                })}\\n\\n`\r\n                controller.enqueue(encoder.encode(transformed))\r\n              } catch (e) {\r\n                // Ignore parse errors\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error(\"[v0] Stream error:\", error)\r\n        controller.error(error)\r\n      } finally {\r\n        controller.close()\r\n      }\r\n    },\r\n  })\r\n\r\n  return new NextResponse(customReadable, {\r\n    headers: {\r\n      \"Content-Type\": \"text/event-stream\",\r\n      \"Cache-Control\": \"no-cache\",\r\n      Connection: \"keep-alive\",\r\n    },\r\n  })\r\n}\r\n"],"names":[],"mappings":"AAAA,6CAA6C;;;;;AAC7C;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAExC,eAAe,IAAI,GAAgB;IACxC,MAAM,UAAU,IAAI;IAEpB,MAAM,iBAAiB,IAAI,eAAe;QACxC,MAAM,OAAM,UAAU;YACpB,IAAI;gBACF,MAAM,WAAW,MAAM,MAAM,GAAG,YAAY,WAAW,CAAC;gBAExD,IAAI,CAAC,SAAS,EAAE,EAAE,MAAM,IAAI,MAAM;gBAElC,MAAM,SAAS,SAAS,IAAI,EAAE;gBAC9B,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;gBAE7B,MAAO,KAAM;oBACX,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,OAAO,IAAI;oBACzC,IAAI,MAAM;oBAEV,8CAA8C;oBAC9C,MAAM,OAAO,IAAI,cAAc,MAAM,CAAC;oBACtC,MAAM,QAAQ,KAAK,KAAK,CAAC;oBACzB,KAAK,MAAM,QAAQ,MAAO;wBACxB,IAAI,KAAK,UAAU,CAAC,WAAW;4BAC7B,IAAI;gCACF,MAAM,OAAO,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC;gCACvC,MAAM,cAAc,CAAC,MAAM,EAAE,KAAK,SAAS,CAAC;oCAC1C,QAAQ,KAAK,OAAO;oCACpB,SAAS,KAAK,QAAQ;oCACtB,UAAU,KAAK,SAAS;oCACxB,WAAW,KAAK,UAAU;oCAC1B,cAAc,KAAK,aAAa;oCAChC,KAAK,KAAK,GAAG,IAAI;oCACjB,WAAW,KAAK,GAAG;gCACrB,GAAG,IAAI,CAAC;gCACR,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC;4BACpC,EAAE,OAAO,GAAG;4BACV,sBAAsB;4BACxB;wBACF;oBACF;gBACF;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,sBAAsB;gBACpC,WAAW,KAAK,CAAC;YACnB,SAAU;gBACR,WAAW,KAAK;YAClB;QACF;IACF;IAEA,OAAO,IAAI,0OAAY,CAAC,gBAAgB;QACtC,SAAS;YACP,gBAAgB;YAChB,iBAAiB;YACjB,YAAY;QACd;IACF;AACF"}}]
}